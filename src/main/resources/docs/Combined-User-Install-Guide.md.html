<h1 id="mist-user-guide">MIST User Guide</h1>
<h2 id="contents">Contents</h2>
<ol>
<li><a href="#launching-mist">Launching MIST</a></li>
<li><a href="#installation-validation-test">Installation Validation Test</a></li>
<li><a href="#mist-graphical-user-interface">MIST Graphical User Interface</a><ol>
<li><a href="#input-parameters">Input Parameters</a></li>
<li><a href="#output-parameters">Output Parameters</a></li>
<li><a href="#subgrid-parameters">Subgrid Parameters</a></li>
<li><a href="#advanced-parameters-optional">Advanced Parameters (optional)</a><ol>
<li><a href="#java-execution">Java Execution</a></li>
<li><a href="#fftw-execution">FFTW Execution</a></li>
<li><a href="#cuda-execution">CUDA Execution</a></li>
</ol>
</li>
<li><a href="#help">Help</a></li>
</ol>
</li>
<li><a href="#mist-status-frame">MIST Status Frame</a></li>
</ol>
<hr>
<h3 id="launching-mist">Launching MIST</h3>
<ol>
<li>Start Fiji.</li>
<li>Click through the menus: <em>Plugins &gt;&gt; Stitching &gt;&gt; MIST</em></li>
<li>Click: <em>MIST</em></li>
</ol>
<hr>
<h3 id="installation-validation-test">Installation Validation Test</h3>
<p>In this section, we will walk through setting up running MIST on one of the 5x5 image tile datasets in order to validate that the plugin is installed correctly.</p>
<ol>
<li>Download test images: [Cy5_ImageTiles.zip ~ 54 MB] (testdata/Small_Fluorescent_Test_Dataset.zip)</li>
<li>Extract Cy5_ImageTiles.zip into a directory</li>
<li><a href="#launching-mist">Launch MIST plugin from Fiji</a></li>
<li>Select <strong>Load Params</strong> and open '\<extractionpath\>\Small_Fluorescent_Test_Dataset\stitching-params.txt'</extractionpath\></li>
<li>To manually enter parameters (avoiding <strong>Load Params</strong>) enter the following values into the Input Tab<ol>
<li><strong>Filename Pattern Type</strong>: 'Row-Column'</li>
<li><strong>Filename Pattern</strong>: 'img_r{rrr}_c{ccc}.tif'</li>
<li><strong>Starting Point</strong>: 'Upper Left'</li>
<li><strong>Grid Width</strong>: '5'</li>
<li><strong>Grid Height</strong>: '5'</li>
</ol>
</li>
<li>Modify <strong>Image Directory</strong> to '\<extractionpath\>\Small_Fluorescent_Test_Dataset\image-tiles'</extractionpath\></li>
<li>Select Output tab and update <strong>Output Directory</strong>, <strong>Metadata Directory</strong>, and <strong>Display Stitched Image</strong> options</li>
<li>To check the parameters defining the image grid, select <strong>Preview Mosaic With No Overlap</strong></li>
<li>Click <strong>Begin Stitching</strong> to launch</li>
<li>Compare the newly generated stitched image to reference stitched image shipped with the dataset<ol>
<li>Open '\<extractionpath\>\Small_Fluorescent_Test_Dataset\stitched-image\img-stitched-0.tif' in Fiji.</extractionpath\></li>
<li>Check that the new stitched image has the same dimensions as the reference</li>
<li>Perform a pixel-wise comparison between the stitched images</li>
<li>Fiji&gt;&gt;Process&gt;&gt;Image Calculator</li>
<li>The operation new stitched image "Difference" reference stitched image should produce an image containing all zeros when using loaded parameters.</li>
</ol>
</li>
</ol>
<hr>
<h3 id="mist-graphical-user-interface">MIST Graphical User Interface</h3>
<p>The MIST plugin consists of five tabs. Below, we outline each tab and discuss all of the parameters. All options labeled with an * are required in order to start stitching. Each tab contains a <strong>?</strong> button that, when clicked, generates a local copy of this documentation.</p>
<hr>
<h4 id="input-parameters">Input Parameters</h4>
<blockquote>
<p><strong>Save Params</strong> Button - Saves all parameters in MIST to a file.</p>
<p><strong>Begin Stitching</strong> Button - Launches the stitching experiment.</p>
<p><strong>Load Params</strong> Button - Loads parameters from a file. Note: <em>Supports loading the statistics file that is generated after each experiment.</em></p>
<p>* <strong>File Pattern Type</strong> - Used to specify the type of file pattern. Possible options: <strong>Sequential</strong> and <strong>Row-Column</strong>.</p>
<p>* <strong>File Pattern</strong> - Used to load images from a directory. Changes based on the <strong>File Pattern Type</strong></p>
<ul>
<li><p>If the <strong>File Pattern Type</strong> = <strong>Sequential</strong>, then the <strong>File Pattern</strong> expects sequential style numbering.</p>
<atom-text-editor class="editor" callattachhooks="true" gutter-hidden="" data-grammar="text plain" data-encoding="utf8"><div class="underlayer"></div><div class="overlayer"></div></atom-text-editor></li>
<li><p>If the <strong>File Pattern Type</strong> = <strong>Row-Column</strong>, then the <strong>File Pattern</strong> expects row-column style numbering.</p>
<atom-text-editor class="editor" callattachhooks="true" gutter-hidden="" data-grammar="text plain" data-encoding="utf8"><div class="underlayer"></div><div class="overlayer"></div></atom-text-editor></li>
</ul>
<p>* <strong>Image Directory</strong> - The directory where the source images are located. Select browse to open a directory browser.</p>
<p>* <strong>Starting Point</strong> - The starting point of the microscope scan. Possible options: <strong>Upper Left</strong>, <strong>Upper Right</strong>, <strong>Lower Left</strong>, and <strong>Lower Right</strong>.</p>
<p>* <strong>Direction</strong> - The direction the microscope moves. Possible options: <strong>Vertical Combing</strong>, <strong>Vertical Continuous</strong>, <strong>Horizontal Combing</strong>, and <strong>Horizontal Continuous</strong>.</p>
<p><strong>Assemble from metadata</strong> - Generates the image mosaic using metadata from a previous run. <strong>Important</strong>:<em>You must specify the metadata directory in the <a href="#output-parameters">output tab</a> to refer to the metadata directory of your previous run.</em></p>
<p>* <strong>Grid Width</strong> - The number of images in a row (The number of columns, the width of the image grid)</p>
<p>* <strong>Grid Height</strong> - The number of images in a column. (The number of rows, the height of the image grid)</p>
<p><strong>Timeslices</strong> - The number of timeslices to stitch. Leave this field blank to stitch all timeslices. To stitch timeslices you must add the spcial format text <strong>{ttt}</strong> to the <strong>File Pattern</strong>. This input supports a comma separated list and/or a range using a '-'.
         Example: "1-25,35,45" stitches timeslices 1 through 25, 35, and 45.</p>
<hr>
</blockquote>
<h4 id="output-parameters">Output Parameters</h4>
<blockquote>
<p><strong>Use Image Directory as Output Directory</strong> - Sets the output directory to be the same as the input directory.</p>
<p><strong>Output Directory</strong> - Specifies the location to save images and run statistics.</p>
<p>Files that are saved:</p>
<ul>
<li><strong>{namePrefix}</strong>stitched-<strong>{#}</strong>.tiff</li>
<li><p><strong>{namePrefix}</strong>statistics.txt</p>
<atom-text-editor class="editor" callattachhooks="true" gutter-hidden="" data-grammar="text plain" data-encoding="utf8"><div class="underlayer"></div><div class="overlayer"></div></atom-text-editor></li>
</ul>
<p><strong>Filename Prefix</strong> - The prefix given to output files.</p>
<p><strong>Metadata Directory</strong> - The directory where metadata is written.</p>
<p>Files that are saved:</p>
<ul>
<li>global-positions-{#}.txt</li>
<li>relative-positions-{#}.txt</li>
<li>relative-positions-no-optimization-{#}.txt</li>
<li><p>hillclimb-startings-positions-{#}.txt</p>
<atom-text-editor class="editor" callattachhooks="true" gutter-hidden="" data-grammar="text plain" data-encoding="utf8"><div class="underlayer"></div><div class="overlayer"></div></atom-text-editor></li>
</ul>
<p><strong>Blending mode</strong> - Selects the blending mode to be used for computing the mosaic image.
Blending Types:</p>
<ul>
<li>Overlay - Choose only one pixel from overlapping pixels based on highest accuracy</li>
<li>Linear - Smoothly alters the intensity of the overlapping area between images. Smoothness is determined by alpha. Value should be between (0, 5]</li>
<li>Average - Computes the average intensity</li>
</ul>
<p><strong>Warning:</strong>: <em>RGB images may cause out of memory issues for linear and average blending. When generating the mosaic of RBG images it is recommended to use overlay images.</em></p>
<p><strong>Display Stitched Image</strong> - Opens the blended image mosaic into Fiji.</p>
<p><strong>Save Full Stitched Image</strong> - Writes the blended image mosaic to the <strong>Output Directory</strong>.</p>
<p><strong>Update</strong> Button - Updates the estimated stitched image file size.</p>
<p><strong>Preview Mosaic With No Overlap</strong> - Opens the image mosaic into Fiji assuming 0% overlap.</p>
<p><strong>Warning</strong>: <em>Large image grids can cause out of memory errors. If the number of pixels in the image exceeds 2147483647 (2<sup>31</sup>-1), then the mosaic image must be exported using an alternative method. (imagePixelWidth*imagePixelHeight &lt; 2147483647)</em></p>
</blockquote>
<hr>
<h4 id="subgrid-parameters">Subgrid Parameters</h4>
<blockquote>
<p><strong>Use full grid</strong> - Updates the subgrid to use the full grid of images.</p>
<p><strong>Start Col</strong> - The start column for the subgrid.</p>
<p><strong>Start Row</strong> - The start row for the subgrid.</p>
<p><strong>Extent Width</strong>- The width for the subgrid.</p>
<p><strong>Extent Height</strong> - The height for the subgrid.</p>
</blockquote>
<hr>
<h4 id="advanced-parameters-optional-">Advanced Parameters (optional)</h4>
<blockquote>
<p><strong>Number of FFT Peaks</strong> - Specifies the number of peaks to check when computing the phase correlation image alignment method. We have determined that modifying this value can yield more accurate pre-optimization displacements. This value should not exceed 10. (Default: 2)</p>
<p><strong>Stage Repeatability</strong> - Sets the stage repeatability variable when computing the global optimization. This value is used to represent the repeatability of the microscope stage movement. It is used for determining the search space of the hill climbing algorithm.</p>
<p><strong>Horizontal overlap</strong> - Sets the horizontal overlap variable when computing the global optimization. This value is used to filter translations as good or bad. Good translations are used to identify the optimal starting position for the hill climbing algorithm. Setting this value can improve the accuracy of the image mosaic.</p>
<p><strong>Vertical overlap</strong> - Sets the vertical overlap variable when computing the global optimization. This value is used to filter translations as good or bad. Good translations are used to identify the optimal starting position for the hill climbing algorithm. Setting this value can improve the accuracy of the image mosaic.</p>
<p><strong>Overlap uncertainty</strong> - Sets the overlap uncertainty variable when computing the global optimization. This value is used to specify the range when filtering translations as good or bad. It is used in conjunction with the horizontal and vertical overlap variables.</p>
<p><strong>Stitching Program</strong> - Selects which type of program to execute.</p>
<ul>
<li>Auto - Determine which program to use. First checks if FFTW is available, if it is not then it falls back to Java.</li>
<li>Java - Uses the pure java implementation. This version uses single precision values, but is not as accurate as FFTW and CUDA.</li>
<li>FFTW - Uses FFTW libraries.</li>
<li>CUDA - Uses NVIDIA CUDA GPUs.</li>
</ul>
</blockquote>
<hr>
<h5 id="java-execution">Java Execution</h5>
<blockquote>
<p><strong>CPU worker threads</strong> - Number of parallel workers to spawn (should not exceed number of CPU cores)</p>
</blockquote>
<hr>
<h5 id="fftw-execution">FFTW Execution</h5>
<blockquote>
<p><strong>CPU worker threads</strong> - Number of parallel workers to spawn (should not exceed number of CPU cores)</p>
<p><strong>FFTW Plan Type</strong> - The type of FFTW plan to generate</p>
<ul>
<li>Measure - Default, short creation time, usually ideal runtimes</li>
<li>Patient - Long planning time, more robust runtimes</li>
<li>Exhaustive - Very long planning time, most robust runtimes</li>
</ul>
<p><em>Note: FFTW plans can be saved and reused to eliminate planning time.</em></p>
<p><strong>Save Plan?</strong> - Saves the FFTW plan that is generated to file.</p>
<p><strong>Load Plan?</strong> - Loads the FFTW plan from file.</p>
<p><strong>FFTW Library File</strong> - Specifies the FFTW library file to load.
Example Files:</p>
<ul>
<li>Windows: libfftw3.dll (this library is packaged with MIST in the "Fiji.app/lib/fftw" directory)</li>
<li>Linux: libfftw3.so (default installation location "/usr/local/lib")</li>
<li>Mac OSX: libfftw3.dylib (default installation location "/usr/local/lib")</li>
</ul>
<p><strong>Plan Location (or file)</strong> - The location to load FFTW plans. If a file is specified, the file will be used when loading the plan. This path is also used for saving plans.</p>
<p><em>Note: <a href="#fftw-installation">FFTW installation instructions</a></em></p>
</blockquote>
<hr>
<h5 id="cuda-execution">CUDA Execution</h5>
<blockquote>
<p><strong>CPU worker threads</strong> - Number of parallel workers to spawn (should not exceed number of CPU cores)</p>
<p><strong>Execute Device Query</strong> - Queries for all GPUs installed on the system and prints the information to the log.</p>
<p><strong>Refresh Device Table</strong> - Forces the table to re-query all GPUs and repopulate the table.</p>
<p><strong>GPU Table</strong> - Displays all available GPUs found on the machine. To use one (or more) GPUs, click the check box in the <strong>Selected?</strong> column.
<em>Note: GPUs have limited memories, it is recommended to use GPUs with at least 1 GB of graphics memory depending on the size of the image grid.</em></p>
<p><em>Note: <a href="#cuda-installation">CUDA Installation instructions</a></em></p>
</blockquote>
<hr>
<h4 id="help">Help</h4>
<blockquote>
<p><strong>Log Level</strong> - Sets the log level for the user interface and the stitching execution.
Possible Options:</p>
<ul>
<li>None - No logging</li>
<li>Mandatory - Logs important information</li>
<li>Helpful - Logs helpful information</li>
<li>Info - Logs informative information</li>
<li>Verbose - Logs all information</li>
</ul>
<p><em>Note: The lower logging stack includes the logging levels above. Example: Helpful, includes Mandatory.</em></p>
<p><strong>Debug Level</strong> - Sets the debug level for the user interface and the stitching execution.
Possible Options:</p>
<ul>
<li>None - No debug logging</li>
<li>Mandatory - Logs important debug information</li>
<li>Helpful - Logs helpful debug information</li>
<li>Info - Logs informative debug information</li>
<li>Verbose - Logs all debug information</li>
</ul>
<p><em>Note: The lower logging stack includes the logging levels above. Example: Helpful, includes Mandatory.</em></p>
<p><strong>Open Help (PDF)</strong> - Opens this document in PDF format.</p>
</blockquote>
<hr>
<h3 id="mist-status-frame">MIST Status Frame</h3>
<blockquote>
<p><strong>Progress</strong> - If timeslices are used, shows the current timeslice, total timeslices, and number of groups (if entered as a comma separated list in the input parameters).</p>
<p><strong>Progress bar</strong> - Shows the % progress made for the current experiment.</p>
<p><strong>Log Level</strong> - Sets the log level for the user interface and the stitching execution.
Possible Options:</p>
<ul>
<li>None - No logging</li>
<li>Mandatory - Logs important information</li>
<li>Helpful - Logs helpful information</li>
<li>Info - Logs informative information</li>
<li>Verbose - Logs all information</li>
</ul>
<p><em>Note: The lower logging stack includes the logging levels above. Example: Helpful, includes Mandatory.</em></p>
<p><strong>Debug Level</strong> - Sets the debug level for the user interface and the stitching execution.
Possible Options:</p>
<ul>
<li>None - No debug logging</li>
<li>Mandatory - Logs important debug information</li>
<li>Helpful - Logs helpful debug information</li>
<li>Info - Logs informative debug information</li>
<li>Verbose - Logs all debug information</li>
</ul>
<p><em>Note: The lower logging stack includes the logging levels above. Example: Helpful, includes Mandatory.</em></p>
<p><strong>Cancel Execution</strong> - Safely stops execution and releases used resources.</p>
</blockquote>
<hr>
<p>* - required in order to start stitching</p>
<h1 id="mist-plugin-installation">MIST Plugin Installation</h1>
<p>Installing the plugin into <a href="http://fiji.sc/Fiji">Fiji</a> is simplified using Fiji's update site manager. If the machine is not configured for the network then please refer to the <a href="#manual-installation">manual installation</a>.</p>
<h3 id="update-site-installation">Update Site Installation</h3>
<ol>
<li>Open Fiji</li>
<li>Help &gt;&gt; Update Fiji</li>
<li>Manage update sites</li>
<li>Activate <strong>MIST</strong> by selecting check box</li>
<li>Close and Apply Changes</li>
<li>Plugin is installed in Plugin &gt;&gt; Stitching &gt;&gt; MIST</li>
</ol>
<h3 id="manual-installation">Manual Installation</h3>
<ol>
<li>Download the latest version of the MIST plugin from [LINK TO ZIP]</li>
<li>Extract the contents of the zip file into your Fiji.app folder</li>
<li>Restart Fiji</li>
<li>Plugin is installed in Plugins &gt;&gt; Stitching &gt;&gt; MIST</li>
</ol>
<h1 id="fftw-installation">FFTW Installation</h1>
<p>FFTW (Fastest Fourer Transform in the West, <a href="http://fftw.org">http://fftw.org</a> ) is a C implementation out of MIT that computes the discrete Fourier transform. The plugin loads the library at run-time and uses the high performance FFTW functions in Java.</p>
<p><strong>Requirements:</strong></p>
<ol>
<li>Fiji (64-bit version)</li>
</ol>
<p>Note: <em>64-bit Windows systems should be able to run the FFTW version without additional setup.</em></p>
<h2 id="fftw-installation-on-unix-64-bit-mac-osx-linux-">FFTW Installation on Unix (64-bit Mac OSX/Linux)</h2>
<ol>
<li>Download fftw-3.3.4.tar.gz from <a href="http://www.fftw.org/download.html">http://www.fftw.org/download.html</a></li>
<li>Extract source code to directory (tar xzvf fftw-3.3.4.tar.gz)</li>
<li><p>From a terminal locate source code and run the following commands:</p>
<atom-text-editor class="editor" callattachhooks="true" gutter-hidden="" data-grammar="text plain" data-encoding="utf8"><div class="underlayer"></div><div class="overlayer"></div></atom-text-editor><p>(If configure fails, additional compilers and/or libraries may be needed)</p>
</li>
<li><p>Launch the Fiji MIST plugin</p>
</li>
<li>Specify the FFTW library file in the <em>Advanced FFTW Options</em> <a href="#fftw-execution">FFTW options user guide</a>  (default FFTW installation location is in /usr/local/lib)<ol>
<li>Linux library name example: <em>libfftw3.so</em> (or similar)</li>
<li>MacOSX library name example: <em>libfftw3.dylib</em> (or similar)</li>
</ol>
</li>
<li>You should now be able to launch MIST using FFTW</li>
</ol>
<h2 id="fftw-installation-using-macports">FFTW Installation using MacPorts</h2>
<ol>
<li>From the command-line: <code>sudo port install fftw-3</code></li>
<li>Launch the Fiji MIST plugin</li>
<li>Specify the FFTW library file in the <em>Advanced FFTW Options</em> <a href="#fftw-execution">FFTW options user guide</a>  (default FFTW installation location is in /usr/local/lib)<ol>
<li>Linux library name example: <em>libfftw3.so</em> (or similar)</li>
<li>MacOSX library name example: <em>libfftw3.dylib</em> (or similar)</li>
</ol>
</li>
<li>You should now be able to launch MIST using FFTW</li>
</ol>
<h1 id="cuda-installation">CUDA Installation</h1>
<p>CUDA is the Compute Unified Device Architecture and is a language developed by NVIDIA. It is used to execute code on NVIDIA GPUs to obtain high performance.</p>
<p><strong>Requirements:</strong></p>
<ol>
<li>NVIDIA GPU installed on your system</li>
<li>CUDA toolkit version 6.5</li>
<li>Fiji 64-bit</li>
</ol>
<p>Once the CUDA toolkit is installed a computer restart might be required before stitching can take advantage of your GPU.</p>
<h3 id="cuda-toolkit-v6-5-installation-on-windows-linux-macosx">CUDA Toolkit v6.5 installation on Windows/Linux/MacOSX</h3>
<ol>
<li>Download CUDA toolkit v6.5 for the appropriate operating system version <a href="http://nvidia.com/getcuda">CUDA Toolkit 6.5</a></li>
<li>Install the CUDA Tookit<ol>
<li>For Windows: Launch the executable and complete the installation</li>
<li>For MacOSX: <a href="http://docs.nvidia.com/cuda/cuda-getting-started-guide-for-mac-os-x/index.html#axzz34MbYZuma">Toolkit MacOSX installation guide</a></li>
<li>For Linux: <a href="http://docs.nvidia.com/cuda/cuda-getting-started-guide-for-linux/index.html#axzz34MbYZuma">Toolkit Linux installation guide</a></li>
</ol>
</li>
<li>Restart your computer</li>
<li>Open Fiji and run MIST plugin</li>
<li>CUDA option should be available in the MIST plugin.</li>
</ol>